parameters:
  openshift4_slos:
    =_metadata: {}
    namespace: appuio-openshift4-slos

    images:
      # The image will not be used. It is here so Renovate can update the Sloth version.
      sloth:
        registry: ghcr.io
        image: slok/sloth
        tag: v0.11.0
      blackbox_exporter:
        registry: docker.io
        image: prom/blackbox-exporter
        tag: v0.22.0
      canary_scheduler_controller:
        registry: quay.io
        image: appuio/scheduler-canary-controller
        tag: v1.0.0
      canary:
        registry: docker.io
        image: curlimages/curl
        tag: "7.86.0"
      network_canary:
        registry: ghcr.io
        image: appuio/network-canary
        tag: v0.1.1

    alerting:
      labels:
        syn: "true"
        syn_component: "openshift4-slos"
        slo: "true"
      page_labels:
        severity: critical
      ticket_labels:
        severity: warning

    slos:
      workload-schedulability:
        canary:
          enabled: true
          objective: 99.75
          _sli:
            podStartInterval: 1m
            overallPodTimeout: 3m

      storage:
        csi-operations:
          enabled: true
          objective: 99.5
          _sli:
            volume_plugin: "kubernetes.io/csi.+"
            operation_name: ".+"
      ingress:
        canary:
          enabled: true
          objective: 99.75
      kubernetes_api:
        requests:
          enabled: true
          objective: 99.9
          _sli:
            apiserver: "kube-apiserver"
        canary:
          enabled: true
          objective: 99.9
          _sli:
            interval: 10s
            timeout: 5s
      network:
        canary:
          enabled: true
          objective: 99.5

    specs: {}

    blackbox_exporter:
      enabled: true
      name: prometheus-blackbox-exporter
      namespace: ${openshift4_slos:namespace}
      probes: {}
      deployment:
        resources:
          limits:
            cpu: '20m'
            memory: '40Mi'
          requests:
            cpu: '10m'
            memory: '20Mi'
      config:
        modules:
          http_2xx:
            http:
              follow_redirects: true
              preferred_ip_protocol: ip4
            prober: http
            timeout: 5s
          http_post_2xx:
            http:
              method: POST
              preferred_ip_protocol: ip4
            prober: http
          ssh_banner:
            prober: tcp
            tcp:
              preferred_ip_protocol: ip4
              query_response:
                - expect: ^SSH-2.0-
          tcp_connect:
            prober: tcp
            tcp:
              preferred_ip_protocol: ip4

    network_canary:
      enabled: ${openshift4_slos:slos:network:canary:enabled}
      namespace: appuio-network-canary
      nodeselector: node-role.kubernetes.io/worker=
      resources:
        limits:
          memory: 40Mi
        requests:
          cpu: 1m
          memory: 20Mi

      tolerations:
        infrastructure:
          effect: NoSchedule
          key: node-role.kubernetes.io/infra
          operator: Exists
        storage:
          key: 'storagenode'
          operator: 'Exists'


    canary_scheduler_controller:
      enabled: true
      manifests_version: ${openshift4_slos:images:canary_scheduler_controller:tag}
      kustomize_input:
        namespace: ${openshift4_slos:namespace}
        patches:
          - patch: |-
              $patch: delete
              apiVersion: v1
              kind: Namespace
              metadata:
                name: appuio-scheduler-canary
